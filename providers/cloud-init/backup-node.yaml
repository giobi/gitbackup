#cloud-config
# Backup Node Setup - gitbackup multi-cloud
# Creates user 'giobi' with sudo, SSH keys from GitHub

users:
  - name: giobi
    groups: sudo
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    ssh_import_id:
      - gh:giobi

package_update: true
package_upgrade: true

packages:
  - git
  - curl
  - htop
  - unattended-upgrades

runcmd:
  # Set hostname based on provider (will be overridden by API)
  - echo "backup-node" > /etc/hostname
  - hostname -F /etc/hostname
  # Clone gitbackup
  - sudo -u giobi git clone https://github.com/giobi/gitbackup.git /home/giobi/gitbackup
  # Create backup directory
  - mkdir -p /home/giobi/backup
  - chown giobi:giobi /home/giobi/backup
  # Signal boot complete
  - touch /home/giobi/.cloud-init-complete

final_message: "Backup node ready after $UPTIME seconds"
